"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.handleClientErrorFactory = void 0;
var tslib_1 = require("tslib");
var shopify_api_1 = require("@shopify/shopify-api");
function handleClientErrorFactory(_a) {
    var request = _a.request, onError = _a.onError;
    return function handleClientError(_a) {
        var error = _a.error, params = _a.params, session = _a.session;
        return tslib_1.__awaiter(this, void 0, void 0, function () {
            return tslib_1.__generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        if (error instanceof shopify_api_1.HttpResponseError !== true) {
                            params.logger.debug("Got a response error from the API: ".concat(error.message));
                            throw error;
                        }
                        params.logger.debug("Got an HTTP response error from the API: ".concat(error.message), {
                            code: error.response.code,
                            statusText: error.response.statusText,
                            body: JSON.stringify(error.response.body),
                        });
                        if (!onError) return [3 /*break*/, 2];
                        return [4 /*yield*/, onError({ request: request, session: session, error: error })];
                    case 1:
                        _b.sent();
                        _b.label = 2;
                    case 2: 
                    // forward a minimal copy of the upstream HTTP response instead of an Error:
                    throw new Response(JSON.stringify(error.response.body), {
                        status: error.response.code,
                        headers: {
                            'Content-Type': error.response.headers['Content-Type'],
                        },
                    });
                }
            });
        });
    };
}
exports.handleClientErrorFactory = handleClientErrorFactory;
//# sourceMappingURL=handle-client-error.js.map